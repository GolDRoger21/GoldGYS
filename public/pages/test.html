<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Çöz | GOLD GYS</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="../styles/tokens.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/portal.css">
    <link rel="stylesheet" href="../css/footer.css">
    <style>
        /* Test Sayfasına Özel Stiller */
        .test-header-card {
            background: linear-gradient(135deg, var(--bg-panel) 0%, #1e293b 100%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: calc(var(--header-height) + 10px);
            z-index: 800;
        }

        .counters-grid {
            display: flex;
            gap: 20px;
        }

        .counter-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 100px;
        }

        .counter-item .label { color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; }
        .counter-item .value { font-weight: 700; font-size: 1.2rem; color: var(--text-white); }

        .counter-item.success .value { color: var(--color-success); }
        .counter-item.danger .value { color: var(--color-danger); }

        /* Şıkların üzerine gelince */
        .option-label:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--gold-primary) !important;
        }

        @media (max-width: 768px) {
            .test-header-card { flex-direction: column; gap: 15px; align-items: stretch; top: calc(var(--header-height) + 6px); }
            .counters-grid { justify-content: space-between; }
            .counter-item { padding: 5px 10px; min-width: auto; }
        }
    </style>
</head>
<body>
    <div id="mainWrapper">
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        <aside class="sidebar" id="sidebar"></aside>
        <div id="app-header-placeholder"></div>

        <main class="main-content" id="main-content">
            <div class="dashboard-container">
                <div class="test-header-card">
                    <div>
                        <h2 style="margin:0; font-size:1.5rem; color:var(--gold-primary);">Konu Tarama Testi</h2>
                        <p style="margin:5px 0 0; color:var(--text-muted); font-size:0.9rem;">Genel Hukuk Bilgisi • 20 Soru</p>
                    </div>

                    <div class="counters-grid">
                        <div class="counter-item success">
                            <span class="value" id="trueVal">0</span>
                            <span class="label">Doğru</span>
                        </div>
                        <div class="counter-item danger">
                            <span class="value" id="falseVal">0</span>
                            <span class="label">Yanlış</span>
                        </div>
                        <div class="counter-item">
                            <span class="value" id="remainVal">0</span>
                            <span class="label">Kalan</span>
                        </div>
                    </div>

                    <button onclick="testEngine.finishTest()" class="btn btn-primary" style="background:var(--gold-primary); color:black; font-weight:600;">
                        Testi Bitir
                    </button>
                </div>

                <div id="questions-container">
                    <div class="loader-spinner" style="margin: 50px auto;"></div>
                </div>
            </div>

            <footer id="app-footer-placeholder" class="app-footer"></footer>
        </main>
    </div>

    <script type="module">
        import { initLayout } from '../js/ui-loader.js';
        import { TestEngine } from '../js/test-engine.js';
        import { db } from "../js/firebase-config.js";
        import { collection, getDocs, limit, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', async () => {
            await initLayout();

            try {
                const qRef = collection(db, "questions");
                const qSnap = await getDocs(query(qRef, limit(5)));

                let questions = [];
                if (!qSnap.empty) {
                    qSnap.forEach(doc => questions.push({ id: doc.id, ...doc.data() }));
                } else {
                    questions = [
                        {
                            id: "demo1",
                            text: "Aşağıdakilerden hangisi 657 sayılı Devlet Memurları Kanunu'na göre memurlara verilen disiplin cezalarından biri değildir?",
                            options: { A: "Uyarma", B: "Kınama", C: "Sürgün", D: "Aylıktan Kesme", E: "Devlet memurluğundan çıkarma" },
                            correctAnswer: "C",
                            solution: "657 sayılı kanunda 'Sürgün' adında bir disiplin cezası bulunmamaktadır. Yer değiştirme cezası vardır ancak sürgün değildir."
                        },
                        {
                            id: "demo2",
                            text: "Türkiye Cumhuriyeti Anayasası'na göre yasama yetkisi kime aittir?",
                            options: { A: "Cumhurbaşkanı", B: "TBMM", C: "Anayasa Mahkemesi", D: "Bakanlar Kurulu", E: "Yargıtay" },
                            correctAnswer: "B",
                            solution: "Anayasa'nın 7. maddesine göre yasama yetkisi Türk Milleti adına Türkiye Büyük Millet Meclisi'nindir."
                        }
                    ];
                }

                window.testEngine = new TestEngine('questions-container', questions, 'demo_exam');

            } catch (error) {
                console.error("Test yükleme hatası:", error);
                document.getElementById('questions-container').innerHTML = `<div class="card"><p style="color:red; text-align:center;">Test yüklenirken hata oluştu.</p></div>`;
            }
        });
    </script>
</body>
</html>
